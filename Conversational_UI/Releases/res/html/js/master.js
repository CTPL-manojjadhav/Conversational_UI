$(document).ready(function(){function e(){var e=new Date,i=e.getHours();c=12>i?"Good Morning. Welcome to  next generation of customer engagement.":18>i?"Good Afternoon. Welcome to  next generation of customer engagement.":"Good Evening. Welcome to  next generation of customer engagement.";var t=e.getMinutes(),a=i>=12?"pm":"am";i%=12,i=i?i:12,t=10>t?"0"+t:t;var n=i+":"+t+" "+a;return n}function i(){$("#loading-small").show(),$.post(locationInt,{userUtterance:$("#userUtterance").val()},function(i){console.log(i.result.reply+"...submit data....."),$("#loading-small").hide(),u=$("#userUtterance").val(),systemUtteranceContentResponse='<li class="mar-btm systemUtterance"><div class="media-left"><img src="img/avatar4.png" class="img-circle img-sm" alt="Profile Picture"></div> <div class="media-body pad-hor"> <div class="speech"><a href="#" class="media-heading"> Bot<p class="speech-time"><i class="fa fa-clock-o fa-fw"></i>'+e()+'</p></a> <p id="">'+i.result.reply+"</p> </div></div></li>",o='<li class="mar-btm userUtterance"><div class="media-right"><img src=" '+updateAvatar+'" class="img-circle img-sm userAvatar" alt="Profile Picture"></div> 	<div class="media-body pad-hor speech-right"><div class="speech"><a href="#" class="media-heading">'+m+' <p class="speech-time"><i class="fa fa-clock-o fa-fw"></i>'+e()+'</p></a><p id="userUtteranceValue">'+u+"</p></div></div></li>",$.trim($("#userUtterance").val())?($("#utterance").append(o).fadeIn(600),$("#utterance").append(systemUtteranceContentResponse).fadeIn(600)):console.log("text area is empty"),d&&(v.text=i.result.reply,speechSynthesis.speak(v)),$("#userUtterance").val(""),$("#scrollBtm").get(0).scrollIntoView()}).fail(function(e,i,a){t("Server error or service unavailable.",!0),alert(a+" error inside submit")})}function t(e,i){null!=e||void 0!=e||"not-allowed"!=e?($("#error").show(0).delay(3500).hide(0),$("#error").html(e)):i?($("#loader").removeClass("loading"),$("#container").delay(3500).animate({opacity:.2},2500)):$("#error:hidden:first").fadeIn(1e3).delay(2e3).fadeOut(1e3)}function a(){return y?(_.stop(),d=!1,void(start_img.src="img/mic.gif")):(d=!0,b="",_.lang="en-GB",_.start(),C=!1,void(start_img.src="img/mic-slash.gif"))}function n(e){if(e){for(var i=info.firstChild;i;i=i.nextSibling)i.style&&(i.style.display=i.id==e?"inline":"none");$("#info").show().delay(3500).fadeOut(1e3)}else $("#info").hide()}$("#error").hide();var s=$("#ip").val()+"/hmi/bot";console.log(s);var r,o,c,l=!1,d=!1;$(".chat-wrapper").hide(),$(".ip-adress").hide(),$(".toggle").click(function(){$(".ip-adress").slideToggle()}),$(".input").focusin(function(){$(this).find("span").animate({opacity:"0"},200)}),$(".input").focusout(function(){$(this).find("span").animate({opacity:"1"},300)});var m,f,g,p;$("#login").click(function(i){return m=$("#username").val(),f=$("#password").val(),g=$("#username").val()+"123",i.preventDefault(),""==m?(alert("User Name is required"),$("#username").parent().parent().addClass("login-error"),$("#username").focus(),!1):""==f?(alert("Password is required"),$("#password").parent().parent().addClass("login-error"),$("#password").focus(),!1):f!=g?(alert("Please enter a valid Password"),!1):(p=$("#ip").val()+"/hmi/bot",void(""!=m&&""!=f&&f==g&&($("#login-wrapper").hide(),$(".chat-wrapper").show(),$("#sidebar").show(),s=p,$(".startChat").click(function(i){$("#start-btn, #startChat").data("clicked",!0),$("#start-button-holder").hide();var a=$("#startChat").is("[disabled=disabled]");a||($("#startChat").attr("disabled","disabled"),$("#startChat").children().addClass("disabled"),$("#loading").show(),$.post(s,function(i,t,a){r='<li class="mar-btm systemUtterance"><div class="media-left"><img src="img/avatar4.png" class="img-circle img-sm" alt="Profile Picture"></div> <div class="media-body pad-hor"> <div class="speech"><a href="#" class="media-heading">HMI Bot <p class="speech-time"><i class="fa fa-clock-o fa-fw"></i>'+e()+'</p></a> <p id="systemUtterance">'+c+", "+i+"</p> </div></div></li>",$("#loading").hide(),$("#utterance").append(r),$("#utterance li:hidden:first").fadeIn(600),locationInt=a.getResponseHeader("location"),console.log(locationInt+" inisde start post")}).fail(function(e,i,a){t("Initialisation failed.",!0),alert(a)}))}))))}),$(".validate").keyup(function(e){$(this).parent().parent().removeClass("login-error")}),$("#password").keydown(function(e){13==e.keyCode&&login.click()}),$("#btnSubmit").click(function(){i()}),$("#userUtterance").keydown(function(e){13==e.keyCode&&i()});updateAvatar="img/avatar1.png";var u;if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){l=!0;var h=!0,v=new SpeechSynthesisUtterance;v.lang="en-GB",v.onend=function(e){a()};var w,y=!1,b="",C=!1,k=k||webkitSpeechRecognition,_=new k;_.continuous=!1,_.interimResults=!1,_.onerror=function(e){C=!0,d=!1,"no-speech"==e.error&&(start_img.src="img/mic.gif",start_img1.src="img/mic-off.png",n("info_no_speech")),"audio-capture"==e.error&&(start_img.src="img/mic.gif",start_img1.src="img/mic-off.png",n("info_no_microphone")),"not-allowed"==e.error&&(e.timeStamp-w<100?(n("info_blocked"),start_img1.src="img/mic-off.png",$("#micOff").children("span").text="MIC OFF"):(n("info_denied"),start_img1.src="img/mic-off.png",$("#micOff span").contents()[0].nodeValue="MIC OFF "))},_.onstart=function(){y=!0,start_img.src="img/mic-animate.gif",n("info_speak_now")},_.onend=function(){if(y=!1,!C){if(start_img.src="img/mic.gif",!b)return void n("info_start");if(n(""),window.getSelection){console.log("web speech window get selected ..."),window.getSelection().removeAllRanges();var e=document.createRange();e.selectNode(document.getElementById("final_span")),window.getSelection().addRange(e)}}},_.onresult=function(e){var a="";if("undefined"==typeof e.results)return _.onend=null,_.stop(),void t("Result undefined",!1);for(var n=e.resultIndex;n<e.results.length;++n)e.results[n].isFinal?b+=e.results[n][0].transcript:a+=e.results[n][0].transcript;$("#userUtterance").val(b),_.continuous||_.stop(),h&&i()},$("#recobtn").click(function(e){a(),start_img.src="img/mic-slash.gif"})}else t("Your Browser doesn't support speech recognition. Try Chrome.",!1),$("#recobtn").prop("disabled",!0);$("#micOff").on("click",function(){var e=$(this).children().attr("src");"img/mic-off.png"===e?(start_img1.src="img/mic-on.png",$("#micOff").children("span").text("MIC ON"),d=!1,a()):"img/mic-on.png"===e&&(start_img1.src="img/mic-off.png",$("#micOff").children("span").text("MIC OFF"),d=!0,a())}),$("#exit").click(function(){$("#start-btn, #startChat").data("clicked")&&($.post(locationInt+"/terminate",function(e){console.log(e+"...inside exit data...")}),console.log(locationInt+" exit url"),$("#utterance").empty(),$("#startChat").removeAttr("disabled"),$("#startChat").children().removeClass("disabled"))})});